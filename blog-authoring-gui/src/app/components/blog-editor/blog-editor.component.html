<div class="blog-editor-container">
  <p-card class="editor-card">
    <div class="editor-header">
      <h2>{{ initialData ? 'Edit Blog Post' : 'Create New Blog Post' }}</h2>
    </div>

    <form [formGroup]="blogForm" class="editor-form">
      <div class="editor-workspace">
        <section class="editor-main-column">
          <!-- Title -->
          <div class="form-group">
            <label for="title">Title *</label>
            <input 
              type="text" 
              id="title" 
              formControlName="title"
              pInputText
              placeholder="Enter blog post title"
              class="full-width">
            <small *ngIf="blogForm.get('title')?.invalid && blogForm.get('title')?.touched" class="error-message">
              Title is required
            </small>
          </div>

          <!-- Summary -->
          <div class="form-group">
            <label for="summary">Summary *</label>
            <textarea 
              id="summary" 
              formControlName="summary"
              rows="3"
              placeholder="Enter a brief summary"
              class="full-width summary-textarea"
              pInputText>
            </textarea>
            <small *ngIf="blogForm.get('summary')?.invalid && blogForm.get('summary')?.touched" class="error-message">
              Summary is required
            </small>
          </div>

          <!-- Content Editor -->
          <div class="form-group">
            <label for="content">Content *</label>
            <p-editor 
              formControlName="content"
              [modules]="editorModules"
              [style]="{'height':'420px'}"
              placeholder="Write your blog post content here...">
            </p-editor>
            <small class="help-text">Use toolbar shortcuts for headings, lists, links, and quote formatting.</small>
            <small *ngIf="blogForm.get('content')?.invalid && blogForm.get('content')?.touched" class="error-message">
              Content is required
            </small>
          </div>
        </section>

        <aside class="editor-side-column">
          <!-- Image Upload -->
          <div class="form-group side-card">
            <label>Featured Image</label>
            <app-image-uploader 
              (imageUploaded)="uploadedImage = $event"
              [currentImage]="uploadedImage">
            </app-image-uploader>
          </div>

          <!-- Tags -->
          <div class="form-group side-card">
            <label>Tags</label>
            <div class="tags-input">
              <input 
                type="text" 
                [(ngModel)]="currentTag"
                (keyup.enter)="addTag()"
                pInputText
                placeholder="Add tag and press Enter"
                [ngModelOptions]="{standalone: true}"
                class="tag-input">
              <p-button 
                label="Add" 
                icon="pi pi-plus"
                (onClick)="addTag()"
                styleClass="p-button-outlined">
              </p-button>
            </div>
            <div class="tags-list" *ngIf="tags.length > 0">
              <p-tag 
                *ngFor="let tag of tags" 
                [value]="tag"
                styleClass="p-mr-1">
                <span>{{ tag }}</span>
                <i class="pi pi-times tag-remove" (click)="removeTag(tag)"></i>
              </p-tag>
            </div>
          </div>

          <!-- Publish Date and Status -->
          <div class="form-row side-card">
            <div class="form-group">
              <label for="publishDate">Publish Date</label>
              <p-calendar 
                formControlName="publishDate"
                [showTime]="true"
                dateFormat="mm/dd/yy"
                inputId="publishDate"
                appendTo="body"
                styleClass="full-width">
              </p-calendar>
            </div>

            <div class="form-group">
              <label for="status">Status</label>
              <p-dropdown 
                formControlName="status"
                [options]="statusOptions"
                optionLabel="label"
                optionValue="value"
                placeholder="Select status"
                inputId="status"
                appendTo="body"
                styleClass="full-width">
              </p-dropdown>
            </div>
          </div>

          <!-- Notifications -->
          <div class="form-group side-card">
            <label>Email Update</label>
            <p-toggleButton
              formControlName="sendEmailUpdate"
              onLabel="Email: On"
              offLabel="Email: Off"
              onIcon="pi pi-envelope"
              offIcon="pi pi-envelope"
              styleClass="full-width">
            </p-toggleButton>
            <small class="help-text">
              If enabled: published posts notify subscribers immediately, and scheduled posts send at publish time.
            </small>
          </div>

          <!-- Category -->
          <div class="form-group side-card">
            <label for="category">Category</label>
            <input 
              type="text" 
              id="category" 
              formControlName="category"
              pInputText
              placeholder="Enter category (optional)">
          </div>
        </aside>
      </div>

      <!-- Actions -->
      <div class="editor-actions">
        <p-button
          label="Preview Card"
          icon="pi pi-image"
          (onClick)="openPreview('card')"
          styleClass="p-button-outlined">
        </p-button>
        <p-button
          label="Preview Full Post"
          icon="pi pi-eye"
          (onClick)="openPreview('full')"
          styleClass="p-button-outlined">
        </p-button>
        <p-button 
          label="Cancel" 
          icon="pi pi-times"
          (onClick)="cancel()"
          styleClass="p-button-outlined">
        </p-button>
        <p-button 
          label="Save Post" 
          icon="pi pi-save"
          (onClick)="savePost()"
          [disabled]="blogForm.invalid || isSaving"
          [loading]="isSaving"
          styleClass="p-button-primary">
        </p-button>
      </div>
    </form>
  </p-card>

  <p-dialog
    [(visible)]="showPreviewDialog"
    [modal]="true"
    [draggable]="false"
    [resizable]="false"
    [dismissableMask]="true"
    [style]="{ width: 'min(980px, 94vw)' }"
    [header]="'Preview: ' + (previewMode === 'card' ? 'Title Card' : 'Full Post')">
    <div class="preview-toolbar">
      <p-button
        label="Title Card"
        icon="pi pi-image"
        (onClick)="setPreviewMode('card')"
        [styleClass]="previewMode === 'card' ? 'p-button-sm' : 'p-button-sm p-button-outlined'">
      </p-button>
      <p-button
        label="Full Post"
        icon="pi pi-eye"
        (onClick)="setPreviewMode('full')"
        [styleClass]="previewMode === 'full' ? 'p-button-sm' : 'p-button-sm p-button-outlined'">
      </p-button>
    </div>

    <section *ngIf="previewMode === 'card'" class="preview-card-frame">
      <div class="preview-card-media" *ngIf="getPreviewImage() as imageUrl">
        <img [src]="imageUrl" [alt]="getPreviewTitle() + ' cover image'" loading="lazy" />
      </div>
      <div class="preview-card-content">
        <div class="preview-card-meta">
          <span><i class="pi pi-calendar"></i> {{ getPreviewPublishDate() | date:'mediumDate' }}</span>
          <span><i class="pi pi-clock"></i> {{ getPreviewReadTimeMinutes() }} min read</span>
          <span><i class="pi pi-bookmark"></i> {{ getPreviewStatus() }}</span>
        </div>
        <h3>{{ getPreviewTitle() }}</h3>
        <p>{{ getPreviewSummary() }}</p>
        <div class="preview-tags" *ngIf="getPreviewTags().length > 0">
          <p-tag *ngFor="let tag of getPreviewTags()" [value]="tag"></p-tag>
        </div>
      </div>
    </section>

    <article *ngIf="previewMode === 'full'" class="preview-post">
      <div class="preview-hero" *ngIf="getPreviewImage() as imageUrl">
        <img [src]="imageUrl" [alt]="getPreviewTitle() + ' hero image'" loading="lazy" />
      </div>
      <header class="preview-post-header">
        <h1>{{ getPreviewTitle() }}</h1>
        <p class="preview-post-summary">{{ getPreviewSummary() }}</p>
        <div class="preview-card-meta">
          <span><i class="pi pi-calendar"></i> {{ getPreviewPublishDate() | date:'mediumDate' }}</span>
          <span><i class="pi pi-clock"></i> {{ getPreviewReadTimeMinutes() }} min read</span>
          <span><i class="pi pi-bookmark"></i> {{ getPreviewStatus() }}</span>
        </div>
        <div class="preview-tags" *ngIf="getPreviewTags().length > 0">
          <p-tag *ngFor="let tag of getPreviewTags()" [value]="tag"></p-tag>
        </div>
      </header>
      <div class="preview-post-body" [innerHTML]="getPreviewContentHtml()"></div>
    </article>
  </p-dialog>
</div>
