<div class="blog-page">
  <div class="container">
    <!-- Page Header -->
    <section class="page-header" appScrollReveal aria-label="Blog overview">
      <h1 class="page-title">Blog</h1>
      <p class="page-subtitle">Insights, tutorials, and technical articles</p>
    </section>

    <!-- Search and Controls -->
    <section class="controls-section" *ngIf="!isLoading">
      <div class="search-container">
        <input 
          type="text" 
          pInputText 
          [(ngModel)]="searchQuery" 
          (input)="filterPosts()"
          placeholder="Search blog posts..."
          class="search-input"
          aria-label="Search blog posts">
        <i class="pi pi-search search-icon" aria-hidden="true"></i>
      </div>
      <p-button 
        [icon]="layout === 'grid' ? 'pi pi-list' : 'pi pi-th-large'"
        (onClick)="toggleLayout()"
        [label]="layout === 'grid' ? 'List View' : 'Grid View'"
        styleClass="p-button-outlined"
        ariaLabel="Toggle between grid and list view">
      </p-button>
    </section>

    <!-- Loading Skeleton -->
    <section *ngIf="isLoading" class="loading-skeleton" aria-label="Loading blog posts">
      <div class="skeleton-card" *ngFor="let i of [1,2,3]">
        <div class="skeleton-image"></div>
        <div class="skeleton-line short"></div>
        <div class="skeleton-line title"></div>
        <div class="skeleton-line"></div>
        <div class="skeleton-line medium"></div>
      </div>
    </section>

    <!-- Blog Posts -->
    <section class="posts-section" *ngIf="!isLoading" aria-label="Blog posts">
      <div [class]="'posts-' + layout" role="list">
        <p-card *ngFor="let post of filteredPosts; trackBy: trackByPost" 
                class="blog-card" 
                role="listitem"
                appScrollReveal>
          <ng-container *ngTemplateOutlet="blogPostCard; context: {post: getPostData(post)}"></ng-container>
        </p-card>
      </div>
      
      <div *ngIf="filteredPosts.length === 0" class="no-posts" appScrollReveal>
        <i class="pi pi-inbox empty-icon" aria-hidden="true"></i>
        <p>No blog posts found. Check back soon!</p>
      </div>
    </section>

    <!-- Newsletter Subscription -->
    <section class="subscription-section" appScrollReveal aria-label="Newsletter subscription">
      <p-card class="subscription-card">
        <div class="subscription-content">
          <h2 class="subscription-title">Subscribe to Newsletter</h2>
          <p class="subscription-description">Get the latest updates, articles, and insights delivered to your inbox.</p>
          <form [formGroup]="subscriptionForm" (ngSubmit)="subscribe()" class="subscription-form" aria-label="Newsletter signup form">
            <div class="form-row">
              <div class="form-group">
                <label for="firstName">First Name</label>
                <input 
                  type="text" 
                  id="firstName" 
                  pInputText 
                  formControlName="firstName"
                  placeholder="First Name"
                  autocomplete="given-name">
              </div>
              <div class="form-group">
                <label for="lastName">Last Name</label>
                <input 
                  type="text" 
                  id="lastName" 
                  pInputText 
                  formControlName="lastName"
                  placeholder="Last Name"
                  autocomplete="family-name">
              </div>
            </div>
            <div class="form-group">
              <label for="email">Email *</label>
              <input 
                type="email" 
                id="email" 
                pInputText 
                formControlName="email"
                placeholder="your.email@example.com"
                autocomplete="email"
                [class.ng-invalid]="subscriptionForm.get('email')?.invalid && subscriptionForm.get('email')?.touched"
                [attr.aria-invalid]="subscriptionForm.get('email')?.invalid && subscriptionForm.get('email')?.touched"
                aria-describedby="emailError">
              <small id="emailError" 
                     *ngIf="subscriptionForm.get('email')?.invalid && subscriptionForm.get('email')?.touched" 
                     class="error-message"
                     role="alert">
                Please enter a valid email address
              </small>
            </div>
            <p-button 
              type="submit"
              label="Subscribe"
              icon="pi pi-send"
              [disabled]="subscriptionForm.invalid || isSubmitting"
              [loading]="isSubmitting"
              ariaLabel="Submit newsletter subscription">
            </p-button>
          </form>
          <p class="privacy-notice">
            <small>By subscribing, you agree to receive email updates. You can unsubscribe at any time.</small>
          </p>
        </div>
      </p-card>
    </section>
  </div>
</div>

<ng-template #blogPostCard let-post="post">
  <div class="blog-post-content">
    <img *ngIf="post.image" 
         [src]="post.image" 
         [alt]="post.title + ' cover image'" 
         class="blog-image"
         loading="lazy">
    <div class="blog-details">
      <div class="blog-meta">
        <span *ngIf="post.publishDate" class="publish-date">
          <i class="pi pi-calendar" aria-hidden="true"></i>
          {{ post.publishDate | date:'mediumDate' }}
        </span>
        <span *ngIf="post.readTime" class="read-time">
          <i class="pi pi-clock" aria-hidden="true"></i>
          {{ post.readTime }} min read
        </span>
        <p-tag 
          *ngFor="let tag of post.tags" 
          [value]="tag"
          severity="info"
          class="blog-tag">
        </p-tag>
      </div>
      <h3 class="blog-title">{{ post.title }}</h3>
      <p class="blog-summary">{{ post.summary }}</p>
      <div class="blog-actions">
        <p-button 
          label="Read More" 
          icon="pi pi-arrow-right"
          styleClass="p-button-text"
          ariaLabel="Read full article: {{ post.title }}">
        </p-button>
      </div>
    </div>
  </div>
</ng-template>
