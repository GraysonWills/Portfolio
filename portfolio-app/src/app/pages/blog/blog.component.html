<div class="blog-page">
  <div class="container">
    <!-- Page Header -->
    <section class="page-header" appScrollReveal aria-label="Blog overview">
      <h1 class="page-title">Blog</h1>
      <p class="page-subtitle">Insights, tutorials, and technical articles</p>
    </section>

    <!-- Subscribe -->
    <section class="subscribe-section" appScrollReveal aria-label="Subscribe to blog updates">
      <div class="subscribe-card">
        <div class="subscribe-copy">
          <h2>Stay Updated</h2>
          <p>Get an email when new posts go live. Double opt-in, unsubscribe anytime.</p>
        </div>
        <div class="subscribe-form">
          <input
            type="email"
            pInputText
            [(ngModel)]="subscribeEmail"
            (keyup.enter)="subscribe()"
            placeholder="you@example.com"
            class="subscribe-input"
            aria-label="Email address" />
          <button
            class="subscribe-btn"
            (click)="subscribe()"
            [disabled]="isSubscribing"
            [attr.aria-busy]="isSubscribing ? 'true' : 'false'">
            {{ isSubscribing ? 'Sending...' : 'Subscribe' }}
          </button>
        </div>
      </div>
    </section>

    <!-- Search and Controls -->
    <section class="controls-section" *ngIf="!isLoading">
      <div class="search-container">
        <input 
          type="text" 
          pInputText 
          [(ngModel)]="searchQuery" 
          (input)="filterPosts()"
          placeholder="Search blog posts..."
          class="search-input"
          aria-label="Search blog posts">
        <i class="pi pi-search search-icon" aria-hidden="true"></i>
      </div>
      <button
        class="layout-toggle-btn"
        (click)="toggleLayout()"
        [attr.aria-label]="layout === 'grid' ? 'Switch to list view' : 'Switch to grid view'">
        <i [class]="layout === 'grid' ? 'pi pi-list' : 'pi pi-th-large'"></i>
        <span>{{ layout === 'grid' ? 'List' : 'Grid' }}</span>
      </button>
    </section>

    <!-- Loading Skeleton -->
    <section *ngIf="isLoading" class="loading-skeleton" aria-label="Loading blog posts">
      <div class="skeleton-card" *ngFor="let i of [1,2,3]">
        <div class="skeleton-image"></div>
        <div class="skeleton-line short"></div>
        <div class="skeleton-line title"></div>
        <div class="skeleton-line"></div>
        <div class="skeleton-line medium"></div>
      </div>
    </section>

    <!--
      ╔══════════════════════════════════════════════════════════════╗
      ║  FUTURE: Blog Sectionalization (like Projects page)        ║
      ║                                                            ║
      ║  Plan: Group blog posts by `category` metadata field.      ║
      ║  Each category becomes a collapsible accordion section.    ║
      ║                                                            ║
      ║  Steps to implement:                                       ║
      ║  1. Add `categoryGroups` property (same pattern as         ║
      ║     ProjectsComponent.categoryGroups)                      ║
      ║  2. Group filteredPosts by metadata.category               ║
      ║  3. Wrap each group in an accordion section with           ║
      ║     expandedCategories toggle (see projects.component.ts)  ║
      ║  4. Reuse the same .accordion-header / .accordion-body     ║
      ║     CSS classes from projects.component.scss               ║
      ║  5. The blog seed data already has `category` in metadata  ║
      ║     (Backend, Career, AI, Automation, etc.)                ║
      ╚══════════════════════════════════════════════════════════════╝
    -->

    <!-- Blog Posts -->
    <section class="posts-section" *ngIf="!isLoading" aria-label="Blog posts">
      <div [class]="'posts-' + layout" role="list">
        <article *ngFor="let post of filteredPosts; trackBy: trackByPost" 
                class="blog-card" 
                role="listitem"
                [routerLink]="['/blog', post.listItemID]"
                (click)="trackPostOpen(post)"
                [attr.aria-label]="'Read: ' + getPostData(post).title"
                appScrollReveal>
          <ng-container *ngTemplateOutlet="blogPostCard; context: {post: getPostData(post)}"></ng-container>
        </article>
      </div>
      
      <div *ngIf="filteredPosts.length === 0" class="no-posts" appScrollReveal>
        <i class="pi pi-inbox empty-icon" aria-hidden="true"></i>
        <p>No blog posts found. Check back soon!</p>
      </div>
    </section>

  </div>
</div>

<ng-template #blogPostCard let-post="post">
  <div class="blog-post-content">
    <img *ngIf="post.image" 
         [src]="post.image" 
         [alt]="post.title + ' cover image'" 
         class="blog-image"
         loading="lazy">
    <div class="blog-details">
      <div class="blog-meta">
        <span *ngIf="post.publishDate" class="publish-date">
          <i class="pi pi-calendar" aria-hidden="true"></i>
          {{ post.publishDate | date:'mediumDate' }}
        </span>
        <span *ngIf="post.readTime" class="read-time">
          <i class="pi pi-clock" aria-hidden="true"></i>
          {{ post.readTime }} min read
        </span>
      </div>
      <h3 class="blog-title">{{ post.title }}</h3>
      <p class="blog-summary">{{ post.summary }}</p>
      <div class="blog-footer">
        <div class="blog-tags" *ngIf="post.tags?.length">
          <span *ngFor="let tag of post.tags.slice(0, 2)" class="blog-tag">{{ tag }}</span>
        </div>
        <span class="read-more-link" [attr.aria-label]="'Read full article: ' + post.title">
          Read More <i class="pi pi-arrow-right"></i>
        </span>
      </div>
    </div>
  </div>
</ng-template>
